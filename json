[
  {"tool_code": "EDIT_FILE", "file_path": "src/convex/ai.ts", "content": "\"use node\";\nimport { action } from \"./_generated/server\";\nimport { v } from \"convex/values\";\nimport { GoogleGenerativeAI } from \"@google/generative-ai\";\nimport { internal } from \"./_generated/api\";\n\n// In a production environment, this should be in process.env.GOOGLE_API_KEY\nconst API_KEY = \"AIzaSyDy42sn_dRoN4YNxGs3Q7FeZu8bm_lNJRY\"; \n\nexport const analyzeMarket = action({\n  args: {},\n  handler: async (ctx) => {\n    try {\n      const genAI = new GoogleGenerativeAI(API_KEY);\n      // Updated to use the currently supported model\n      const model = genAI.getGenerativeModel({ model: \"gemini-1.5-flash\" });\n\n      // Simulate fetching market data (in a real app, fetch from an API)\n      const marketData = {\n        goldPrice: 2000 + Math.random() * 100 - 50,\n        qiePrice: 0.45 + Math.random() * 0.1 - 0.05,\n        volatilityIndex: 15 + Math.random() * 10,\n        globalUncertainty: Math.random() > 0.5 ? \"High\" : \"Moderate\",\n      };\n\n      const prompt = `\n        You are an expert AI financial analyst for the Aurum-AI liquidity protocol.\n        Analyze the following market data and decide whether the vault should be \\\"RISK_ON\\\" (seeking yield) or \\\"RISK_OFF\\\" (preserving capital).\n        \n        Market Data:\n        - Gold Price: $${marketData.goldPrice.toFixed(2)}\n        - QIE Token Price: $${marketData.qiePrice.toFixed(4)}\n        - Volatility Index: ${marketData.volatilityIndex.toFixed(2)}\n        - Global Uncertainty: ${marketData.globalUncertainty}\n\n        Provide a JSON response with two fields:\n        1. \\\"status\\\": either \\\"RISK_ON\\\" or \\\"RISK_OFF\\\"\n        2. \\\"analysis\\\": a concise 1-2 sentence explanation of your decision based on the data.\n        \n        Do not include markdown formatting in the response, just the raw JSON string.\n      `;\n\n      const result = await model.generateContent(prompt);\n      const response = result.response;\n      const text = response.text();\n      \n      // Clean up the text to ensure it's valid JSON\n      // Remove markdown code blocks if present\n      const jsonStr = text.replace(/